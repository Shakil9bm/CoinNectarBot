<div id="coinnectar-widget" style="max-width:420px;margin:auto;text-align:center;font-family:'Segoe UI',sans-serif;">
  <h2 style="color:#007bff;">CoinNectarBot - Earn Crypto</h2>
  <div id="balance" style="background:#d4edda;color:#155724;padding:10px;border-radius:8px;font-weight:bold;margin:10px 0;">
    Balance: $<span id="userBalance">0.00</span>
  </div>
  <p><strong>Ads Watched:</strong> <span id="adsWatched">0</span> / 20</p>
  <div style="height:10px;background:#e0e0e0;border-radius:5px;">
    <div id="progressBar" style="width:0%;height:100%;background:#007bff;border-radius:5px;"></div>
  </div>
  <p id="timer" style="margin-top:10px;color:#777;">Next reset in: 23h 59m</p>
  <button id="watchAdBtn" style="background:#28a745;color:#fff;border:none;padding:12px 20px;border-radius:30px;cursor:pointer;margin-top:15px;">üé¨ Watch Ad ($0.01)</button>
  <p style="font-size:0.8em;color:#888;margin-top:15px;">Powered by CoinNectarBot</p>
</div>

<!-- MoneTag SDK -->
<script src="https://libtl.com/sdk.js" data-zone="10030164" data-sdk="show_10030164"></script>

<!-- Adsterra backup banner -->
<script type="text/javascript" src="//pl27620444.effectivegatecpm.com/fb/7c/fe/fb7cfe1564e94bf1ad4d65f6f3f36804.js"></script>

<script>
const userBalanceEl = document.getElementById('userBalance');
const adsWatchedEl = document.getElementById('adsWatched');
const progressBar = document.getElementById('progressBar');
const timerEl = document.getElementById('timer');
const watchAdBtn = document.getElementById('watchAdBtn');

let userBalance = parseFloat(localStorage.getItem('cn_balance')) || 0.00;
let adsWatched = parseInt(localStorage.getItem('cn_adsWatched')) || 0;
let lastReset = parseInt(localStorage.getItem('cn_lastReset')) || Date.now();

const dailyLimit = 20;
const adReward = 0.01;

function saveData(){
  localStorage.setItem('cn_balance', userBalance.toFixed(2));
  localStorage.setItem('cn_adsWatched', adsWatched);
  localStorage.setItem('cn_lastReset', lastReset);
}

function updateUI(){
  userBalanceEl.textContent = userBalance.toFixed(2);
  adsWatchedEl.textContent = adsWatched;
  progressBar.style.width = `${(adsWatched/dailyLimit)*100}%`;
  if(adsWatched >= dailyLimit){
    watchAdBtn.disabled = true;
    watchAdBtn.textContent = "‚úÖ Daily Limit Reached";
    watchAdBtn.style.background = "#6c757d";
  }
  saveData();
}

function resetDaily(){
  const now = Date.now();
  if(now - lastReset >= 24*60*60*1000){
    adsWatched = 0;
    lastReset = now;
    saveData();
  }
}

function countdown(){
  const now = Date.now();
  const nextReset = lastReset + 24*60*60*1000;
  const left = nextReset - now;
  if(left <= 0){
    resetDaily();
    updateUI();
    return;
  }
  const h = Math.floor(left / (1000*60*60));
  const m = Math.floor((left % (1000*60*60)) / (1000*60));
  const s = Math.floor((left % (1000*60)) / 1000);
  timerEl.textContent = `Next reset in: ${h}h ${m}m ${s}s`;
}
setInterval(countdown, 1000);

async function startAd(){
  if(adsWatched >= dailyLimit) return;
  watchAdBtn.disabled = true;
  watchAdBtn.textContent = "Loading Ad...";

  // Load Adsterra fallback banner (optional)
  const backup = document.createElement('script');
  backup.src = "//pl27620444.effectivegatecpm.com/fb/7c/fe/fb7cfe1564e94bf1ad4d65f6f3f36804.js";
  document.body.appendChild(backup);

  // Main MoneTag Ad
  try {
    if(typeof show_10030164 === 'function'){
      await show_10030164();
      // Reward only if ad completes successfully
      adsWatched++;
      userBalance += adReward;
      alert('‚úÖ Ad watched successfully! +$0.01 credited');
    } else {
      alert('‚ö†Ô∏è Ad not ready yet. Please try again.');
    }
  } catch(e){
    alert('‚ùå Ad closed early or failed. No reward added.');
  }

  watchAdBtn.disabled = false;
  watchAdBtn.textContent = "üé¨ Watch Ad ($0.01)";
  updateUI();
}

watchAdBtn.addEventListener('click', startAd);
resetDaily();
updateUI();
</script>
