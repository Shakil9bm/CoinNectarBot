<div id="coinnectar-widget" style="max-width:420px;margin:auto;text-align:center;font-family:'Segoe UI',sans-serif; background: linear-gradient(to bottom, #fff0f5, #ffe6f0); padding:25px; border-radius:20px; box-shadow:0 8px 20px rgba(0,0,0,0.2);">
  <h2 style="color:#d63384; font-weight:bold; font-size:1.8em; margin-bottom:15px;">ðŸŒ¸ CoinNectarBot - Earn Crypto ðŸŒ¸</h2>
  
  <div id="balance" style="background:#fff0f5; color:#d63384; padding:15px; border-radius:12px; font-weight:bold; margin:15px 0; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
    Balance: $<span id="userBalance">0.00</span>
  </div>

  <p style="font-weight:bold; color:#6f42c1;"><strong>Ads Watched:</strong> <span id="adsWatched">0</span> / 20</p>
  <div style="height:15px;background:#f0e6ff;border-radius:10px; overflow:hidden; margin-bottom:15px;">
    <div id="progressBar" style="width:0%;height:100%;background:#d63384;border-radius:10px;"></div>
  </div>

  <p id="timer" style="margin-top:10px;color:#555; font-style:italic;">Next reset in: 23h 59m</p>
  <p id="visitTime" style="margin-top:5px;color:#555; font-style:italic;">Time on page: 0m 0s</p>

  <button id="watchAdBtn" style="background:#d63384; color:#fff; border:none; padding:14px 25px; border-radius:30px; cursor:pointer; font-weight:bold; font-size:1em; margin-top:15px; box-shadow:0 4px 10px rgba(0,0,0,0.2);">ðŸŽ¬ Watch Ad ($0.01)</button>
  
  <p style="font-size:0.8em;color:#888;margin-top:20px;">Powered by ðŸŒ¸ CoinNectarBot ðŸŒ¸</p>
</div>

<!-- MoneTag SDK -->
<script src="https://libtl.com/sdk.js" data-zone="10030164" data-sdk="show_10030164"></script>

<!-- Adsterra backup banner -->
<script type="text/javascript" src="//pl27620444.effectivegatecpm.com/fb/7c/fe/fb7cfe1564e94bf1ad4d65f6f3f36804.js"></script>

<script>
const userBalanceEl = document.getElementById('userBalance');
const adsWatchedEl = document.getElementById('adsWatched');
const progressBar = document.getElementById('progressBar');
const timerEl = document.getElementById('timer');
const watchAdBtn = document.getElementById('watchAdBtn');
const visitTimeEl = document.getElementById('visitTime');

let userBalance = parseFloat(localStorage.getItem('cn_balance')) || 0.00;
let adsWatched = parseInt(localStorage.getItem('cn_adsWatched')) || 0;
let lastReset = parseInt(localStorage.getItem('cn_lastReset')) || Date.now();

const dailyLimit = 20;
const adReward = 0.01;
let visitStart = Date.now();

function saveData(){
  localStorage.setItem('cn_balance', userBalance.toFixed(2));
  localStorage.setItem('cn_adsWatched', adsWatched);
  localStorage.setItem('cn_lastReset', lastReset);
}

function updateUI(){
  userBalanceEl.textContent = userBalance.toFixed(2);
  adsWatchedEl.textContent = adsWatched;
  progressBar.style.width = `${(adsWatched/dailyLimit)*100}%`;

  if(adsWatched >= dailyLimit){
    watchAdBtn.disabled = true;
    watchAdBtn.textContent = "âœ… Daily Limit Reached";
    watchAdBtn.style.background = "#6c757d";
  } else {
    watchAdBtn.disabled = false;
    watchAdBtn.textContent = `ðŸŽ¬ Watch Ad ($${adReward.toFixed(2)})`;
    watchAdBtn.style.background = "#d63384";
  }

  saveData();
}

function resetDaily(){
  const now = Date.now();
  if(now - lastReset >= 24*60*60*1000){
    adsWatched = 0;
    lastReset = now;
    saveData();
  }
}

function countdown(){
  const now = Date.now();
  const nextReset = lastReset + 24*60*60*1000;
  const left = nextReset - now;

  if(left <= 0){
    resetDaily();
    updateUI();
    return;
  }

  const h = Math.floor(left / (1000*60*60));
  const m = Math.floor((left % (1000*60*60)) / (1000*60));
  const s = Math.floor((left % (1000*60)) / 1000);
  timerEl.textContent = `Next reset in: ${h}h ${m}m ${s}s`;
}

function trackVisitTime(){
  const now = Date.now();
  const diff = now - visitStart;
  const m = Math.floor(diff / (1000*60));
  const s = Math.floor((diff % (1000*60)) / 1000);
  visitTimeEl.textContent = `Time on page: ${m}m ${s}s`;
}

async function startAd(){
  if(adsWatched >= dailyLimit) return;

  watchAdBtn.disabled = true;
  watchAdBtn.textContent = "Loading Ad...";

  adsWatched++;
  userBalance += adReward;
  updateUI();

  try {
    let adCompleted = false;

    if(typeof show_10030164 === 'function'){
      adCompleted = await new Promise(resolve => {
        show_10030164({
          onComplete: () => resolve(true),
          onCloseEarly: () => resolve(false)
        });
      });
    }

    if(!adCompleted){
      adCompleted = await new Promise(resolve => {
        const adWin = confirm("ðŸ’¡ Watch Adsterra ad completely to continue.");
        resolve(adWin);
      });
    }

  } catch(e){
    console.error(e);
  }

  watchAdBtn.disabled = false;
  watchAdBtn.textContent = `ðŸŽ¬ Watch Ad ($${adReward.toFixed(2)})`;
}

watchAdBtn.addEventListener('click', startAd);
resetDaily();
updateUI();
setInterval(countdown, 1000);
setInterval(trackVisitTime, 1000);
</script>
