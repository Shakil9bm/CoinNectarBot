<div id="coinnectar-widget" style="max-width:400px;margin:auto;font-family:'Segoe UI',sans-serif;">
  <div style="background:#fff;padding:20px;border-radius:12px;box-shadow:0 3px 15px rgba(0,0,0,0.1);">
    <h2 style="color:#007bff;text-align:center;">CoinNectarBot</h2>
    <p style="text-align:center;color:#555;">Earn Crypto by Watching Full Ads!</p>

    <div style="background:#d4edda;color:#155724;padding:10px;border-radius:8px;font-weight:bold;text-align:center;margin-bottom:10px;">
      <span>Your Balance:</span> <span id="cnBalance">$0.00</span>
    </div>

    <p style="text-align:center;color:#444;">Watched Today: <span id="adsCount">0</span>/20</p>

    <button id="cnWatchAdBtn" style="background:#28a745;color:#fff;border:none;padding:10px 20px;border-radius:30px;cursor:pointer;font-size:1em;width:100%;">
      Watch Full Ad & Earn $0.01
    </button>

    <div id="cnAdContainer" style="margin-top:15px;text-align:center;color:#555;">Ad will appear here</div>

    <p style="font-size:0.85em;color:#777;text-align:center;margin-top:15px;">Powered by CoinNectarBot</p>
  </div>

  <script type="text/javascript">
//<![CDATA[
(function(){
  const BAL_KEY = 'cn_balance';
  const COUNT_KEY = 'cn_ads_count';
  const DATE_KEY = 'cn_last_date';
  const TODAY = new Date().toDateString();
  const LIMIT = 20;

  let balance = parseFloat(localStorage.getItem(BAL_KEY)) || 0;
  let adsWatched = parseInt(localStorage.getItem(COUNT_KEY)) || 0;
  const lastDate = localStorage.getItem(DATE_KEY);

  if(lastDate !== TODAY){
    adsWatched = 0;
    localStorage.setItem(DATE_KEY, TODAY);
  }

  const balanceEl = document.getElementById('cnBalance');
  const countEl = document.getElementById('adsCount');
  const btn = document.getElementById('cnWatchAdBtn');
  const adBox = document.getElementById('cnAdContainer');

  balanceEl.textContent = `$${balance.toFixed(2)}`;
  countEl.textContent = adsWatched;

  function saveProgress(){
    localStorage.setItem(BAL_KEY, balance.toFixed(2));
    localStorage.setItem(COUNT_KEY, adsWatched);
    localStorage.setItem(DATE_KEY, TODAY);
  }

  function addReward(){
    balance += 0.01;
    adsWatched += 1;
    saveProgress();
    balanceEl.textContent = `$${balance.toFixed(2)}`;
    countEl.textContent = adsWatched;
  }

  btn.addEventListener('click', () => {
    if(adsWatched >= LIMIT){
      alert('You have reached today’s 20 ad limit!');
      return;
    }

    btn.disabled = true;
    btn.style.background = '#6c757d';
    btn.textContent = 'Loading Ad...';
    adBox.innerHTML = '<p>Ad is loading...</p>';

    // Load MoneTag
    const mt = document.createElement('script');
    mt.src = '//libtl.com/sdk.js';
    mt.setAttribute('data-zone', '10030164');
    mt.setAttribute('data-sdk', 'show_10030164');
    document.body.appendChild(mt);

    // Load Adsterra
    const adst = document.createElement('script');
    adst.src = '//pl27620444.effectivegatecpm.com/fb/7c/fe/fb7cfe1564e94bf1ad4d65f6f3f36804.js';
    document.body.appendChild(adst);

    // Simulate full ad watch (10 seconds required)
    setTimeout(() => {
      if (typeof show_10030164 === 'function') {
        show_10030164().then(() => {
          let watchTime = 0;
          const timer = setInterval(() => {
            watchTime++;
            adBox.innerHTML = `<p>Watching ad... ${watchTime}s</p>`;
            if (watchTime >= 10) {
              clearInterval(timer);
              addReward();
              alert('✅ Full ad watched! $0.01 added.');
              adBox.innerHTML = '<p style="color:#28a745;">Ad completed successfully!</p>';
              btn.disabled = false;
              btn.style.background = '#28a745';
              btn.textContent = 'Watch Full Ad & Earn $0.01';
            }
          }, 1000);
        }).catch(() => {
          adBox.innerHTML = '<p style="color:red;">Ad failed to load.</p>';
          btn.disabled = false;
          btn.style.background = '#28a745';
          btn.textContent = 'Watch Full Ad & Earn $0.01';
        });
      } else {
        adBox.innerHTML = '<p style="color:red;">Ad SDK not loaded properly.</p>';
        btn.disabled = false;
        btn.style.background = '#28a745';
        btn.textContent = 'Watch Full Ad & Earn $0.01';
      }
    }, 2000);
  });
})();
//]]>
  </script>
</div>
