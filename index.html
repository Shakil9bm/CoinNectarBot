<div id="coinnectar-widget">
  <div class="widget-container">
    <h2>CoinNectarBot</h2>
    <p>Earn Crypto by Watching Ads!</p>

    <div class="balance-display">
      <span>Your Balance:</span> <span id="cnBalance">$0.00</span>
    </div>

    <div class="progress-container">
      <div id="cnProgressBar" class="progress-bar"></div>
    </div>
    <p>Ads Watched: <span id="cnAdsWatched">0</span> / 20</p>
    <p>Next reset in: <span id="cnResetTimer">23h 59m</span></p>

    <button id="cnWatchAdBtn">Watch Ad (Earn $0.01)</button>

    <div id="cnAdContainer">
      <p style="color:#555;text-align:center;padding-top:50px;">Ad will appear here</p>
    </div>

    <p class="footer-note">Powered by CoinNectarBot Blogger Version</p>
  </div>

  <script type="text/javascript">
//<![CDATA[
let balance = parseFloat(localStorage.getItem('cn_balance')) || 0;
let adsWatched = parseInt(localStorage.getItem('cn_ads_watched')) || 0;
let lastReset = parseInt(localStorage.getItem('cn_last_reset')) || Date.now();
const dailyLimit = 20;
const adDuration = 10;
let adTimer=null, adTimeLeft=adDuration, adPlaying=false;

const balanceEl=document.getElementById('cnBalance');
const adsWatchedEl=document.getElementById('cnAdsWatched');
const progressBar=document.getElementById('cnProgressBar');
const resetTimerEl=document.getElementById('cnResetTimer');
const watchBtn=document.getElementById('cnWatchAdBtn');
const adContainer=document.getElementById('cnAdContainer');

function saveData(){
  localStorage.setItem('cn_balance', balance.toFixed(2));
  localStorage.setItem('cn_ads_watched', adsWatched);
  localStorage.setItem('cn_last_reset', lastReset);
}

function checkReset(){
  const now = Date.now();
  if(now - lastReset >= 24*60*60*1000){
    adsWatched=0;
    lastReset=now;
    saveData();
  }
}

function updateUI(){
  balanceEl.textContent=`$${balance.toFixed(2)}`;
  adsWatchedEl.textContent=adsWatched;
  progressBar.style.width=`${(adsWatched/dailyLimit)*100}%`;

  if(adsWatched>=dailyLimit){
    watchBtn.disabled=true;
    watchBtn.textContent='Daily Limit Reached';
  } else if(!adPlaying){
    watchBtn.disabled=false;
    watchBtn.textContent='Watch Ad (Earn $0.01)';
  }
}

function updateResetTimer(){
  const now=Date.now();
  const nextReset=lastReset + 24*60*60*1000;
  const diff=nextReset-now;
  const h=Math.floor(diff/(1000*60*60));
  const m=Math.floor((diff%(1000*60*60))/(1000*60));
  const s=Math.floor((diff%(1000*60))/1000);
  resetTimerEl.textContent=`${h}h ${m}m ${s}s`;
}

function startAd(){
  if(adPlaying || adsWatched>=dailyLimit) return;
  adPlaying=true;
  watchBtn.disabled=true;
  watchBtn.textContent='Ad Playing...';

  adContainer.innerHTML='';

  // MoneTag Ad
  const mtScript=document.createElement('script');
  mtScript.src='//libtl.com/sdk.js';
  mtScript.setAttribute('data-zone','10030164');
  mtScript.setAttribute('data-sdk','show_10030164');
  adContainer.appendChild(mtScript);

  // Adsterra Ad
  const adScript=document.createElement('script');
  adScript.type='text/javascript';
  adScript.src='//pl27620444.effectivegatecpm.com/fb/7c/fe/fb7cfe1564e94bf1ad4d65f6f3f36804.js';
  adContainer.appendChild(adScript);

  let startPerf=performance.now();
  adTimeLeft=adDuration;

  const timerDisplay=document.createElement('div');
  timerDisplay.style.position='absolute';
  timerDisplay.style.bottom='5px';
  timerDisplay.style.right='5px';
  timerDisplay.style.background='rgba(0,0,0,0.6)';
  timerDisplay.style.color='white';
  timerDisplay.style.padding='5px 10px';
  timerDisplay.style.borderRadius='5px';
  adContainer.appendChild(timerDisplay);

  adTimer=setInterval(()=>{
    const elapsed=Math.floor((performance.now()-startPerf)/1000);
    adTimeLeft=adDuration-elapsed;
    timerDisplay.textContent=`Time left: ${adTimeLeft}s`;
    if(adTimeLeft<=0){
      clearInterval(adTimer);
      adPlaying=false;
      adsWatched++;
      balance+=0.01;
      saveData();
      updateUI();
      adContainer.innerHTML='<p style="color:#28a745;text-align:center;padding-top:50px;">Ad Finished! Earnings Credited.</p>';
      setTimeout(()=>{adContainer.innerHTML='<p style="color:#555;text-align:center;padding-top:50px;">Ready for next ad.</p>';},2000);
    }
  },500);
}

watchBtn.addEventListener('click', startAd);

checkReset();
updateUI();
updateResetTimer();
setInterval(updateResetTimer,1000);
//]]>
  </script>
</div>
